<div [ngClass]="{'message': true, 'select__chats': isChatSelect}">
  <div class="message__one">
    <div class="message__one-title">
      <div (click)="toggleMessage($event)" class="close">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            fill="#000"
            d="M18.692 5.308a1.05 1.05 0 0 0-1.487 0L12 10.513 6.795 5.308a1.052 1.052 0 0 0-1.487 1.487L10.513 12l-5.205 5.205a1.052 1.052 0 1 0 1.487 1.487L12 13.487l5.205 5.205a1.051 1.051 0 1 0 1.487-1.487L13.487 12l5.205-5.205c.41-.41.41-1.076 0-1.487"
          />
        </svg>
      </div>
      <h2>Сообщения</h2>
    </div>
    <div class="message__one-settings">
      <button>Включить уведомления</button>
      <button>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="none"
          viewBox="0 0 24 24"
          class="ChatListTabs__icon-fL_YG"
        >
          <path
            fill="currentColor"
            d="M12 2c-4.962 0-9 4.037-9 9v4c0 1.654 1.346 3 3 3h3v-8H5.08C5.568 6.614 8.481 4 12 4s6.432 2.614 6.92 6H15v8h3c.161 0 .315-.023.469-.047C17.782 19.168 16.493 20 15 20h-4v2h4c3.309 0 6-2.691 6-6v-5c0-4.963-4.038-9-9-9M7 16H6c-.551 0-1-.448-1-1v-3h2zm12-1c0 .552-.449 1-1 1h-1v-4h2z"
          ></path>
        </svg>
        Чат с поддержкой
      </button>
    </div>

    <div class="message__one-chats">
      <div
        class="chat"
        *ngFor="let chat of chats"
        (click)="selectChat(chat); setClass()"
      >
        <img [src]="chat.avatar" alt="avatar" />
        <div class="chat__right">
          <div class="chat__right-head">
            <p>{{ chat.sellerType }}</p>
            <span>
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                fill="none"
                viewBox="0 0 16 16"
                class="ChatSnippet2__icon-RyE3A ChatSnippet2__icon_checked-Ctfwp"
              >
                <path
                  fill="currentColor"
                  d="M11 4.643 4.997 12 1 8.765l.999-1.121 2.78 2.25 5.059-6.2zm2.838-.949-5.059 6.2-.466-.377-.948 1.162L8.997 12 15 4.643z"
                ></path>
              </svg>
              {{ chat.lastMessageTime }}
            </span>
          </div>
          <div class="chat__right-main">
            <p class="name">{{ chat.carName }}</p>
            <p class="price">· <span>{{ chat.price }}</span></p>
          </div>
          <div class="chat__right-foot">
            <p>{{ chat.lastMessage }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="message__two" *ngIf="selectedChat">
    <div class="message__two-head">
      <h3>{{ selectedChat.sellerType }}</h3>
      <div class="two__head-right">
        <p 
          *ngIf="selectedChat" 
          [ngClass]="{ 'online': getLastSeenText() === 'в сети' }">
          {{ getLastSeenText() }}
        </p>
        <div (click)="startCall()" class="phone">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M5.13709 12.7653L8.15456 9.08664C8.46255 8.69065 8.61655 8.49264 8.69726 8.27058C8.76867 8.07409 8.79821 7.86484 8.784 7.65625C8.76793 7.42053 8.67477 7.18763 8.48846 6.72184L7.77776 4.9451C7.50204 4.25579 7.36417 3.91113 7.12635 3.68522C6.91678 3.48615 6.65417 3.35188 6.37009 3.29854C6.0477 3.238 5.68758 3.32804 4.96733 3.5081L3 4C3 14 9.99969 21 20 21L20.4916 19.0324C20.6717 18.3121 20.7617 17.952 20.7012 17.6296C20.6478 17.3456 20.5136 17.0829 20.3145 16.8734C20.0886 16.6355 19.7439 16.4977 19.0546 16.222L17.4691 15.5877C16.9377 15.3752 16.672 15.2689 16.4071 15.2608C16.1729 15.2536 15.9404 15.3013 15.728 15.4001C15.4877 15.512 15.2854 15.7143 14.8807 16.119L11.8165 19.1679M17.9997 9L17.9997 3M14.9997 6H20.9997" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <button (click)="startCall()" class="call-button">Позвонить</button>
        </div>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          fill="none"
          viewBox="0 0 24 24"
        >
          <path
            fill="currentColor"
            fill-rule="evenodd"
            d="M16 12a2 2 0 1 1 4 0 2 2 0 0 1-4 0m-6 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0m-6 0a2 2 0 1 1 4 0 2 2 0 0 1-4 0"
            clip-rule="evenodd"
          />
        </svg>
      </div>
    </div>
    <div class="message__two-select">
      <img [src]="selectedChat.avatar" alt="" />
      <div class="select__info">
        <p>{{ selectedChat.price }}</p>
        <a [routerLink]="['/']" target="_blank">{{ selectedChat.carName }}</a>
      </div>
    </div>
    <div class="incoming-call-modal" *ngIf="isIncomingCall">
  <div class="modal-content">
    <h3>Входящий звонок</h3>
    <p>Звонит пользователь {{ incomingCallSender || 'Неизвестный' }}</p>
    <div class="modal-buttons">
      <button class="accept-button" (click)="acceptCall()">Принять</button>
      <button class="decline-button" (click)="declineCall()">Отклонить</button>
    </div>
  </div>
</div>
    <div class="video-call" *ngIf="isCallActive">
      <video id="localVideo" autoplay playsinline muted></video>
      <video id="remoteVideo" autoplay playsinline></video>
      <button (click)="endCall()" class="end-call-button">Завершить звонок</button>
    </div>
    <div class="message__two-chat">
      <div class="chat__message">
        <div class="chatDateDivider">Сегодня</div>
        <div *ngFor="let message of messages" [ngClass]="getMessageClass(message)">
          <div class="chat_message">
            <p class="chat_message-text">{{ message.content }}</p>
            <div class="message__absolute">
              <p>{{ message.time }}</p>
              <span class="status">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  fill="none"
                  viewBox="0 0 16 16"
                >
                  <path
                    fill="currentColor"
                    d="M1.475 7.346a.75.75 0 0 1 1.06.01L4.55 9.41l4.826-5.886a.75.75 0 0 1 1.16.952l-5.357 6.532a.75.75 0 0 1-1.115.05L1.464 8.405a.75.75 0 0 1 .011-1.06M7 10l1-1 .5.5 4.875-5.976a.75.75 0 0 1 1.16.952l-5.357 6.532a.75.75 0 0 1-1.035.12z"
                  />
                </svg>
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="chat__footer">
        <div class="chat__footer-placeholder">
          <p *ngFor="let placeholder of placeholders" (click)="insertPlaceholder(placeholder)">
            {{ placeholder }}
          </p>
        </div>
        <div class="chat__footer-input">
          <div class="trigger">
            <div class="file">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                fill="none"
                viewBox="0 0 24 24"
              >
                <path
                  fill="currentColor"
                  d="M17.462 15.4a.976.976 0 0 1 1.375.012 1 1 0 0 1 .012 1.392l-3.122 3.16A6.83 6.83 0 0 1 10.87 22a6.83 6.83 0 0 1-4.858-2.036A7 7 0 0 1 4 15.048c0-1.844.724-3.612 2.012-4.915l5.552-5.617a4.9 4.9 0 0 1 1.593-1.113 4.86 4.86 0 0 1 5.406 1.051 5 5 0 0 1 1.072 1.631 5.02 5.02 0 0 1-1.133 5.452l-5.55 5.618a2.93 2.93 0 0 1-2.082.873c-.78 0-1.53-.314-2.082-.872a3 3 0 0 1-.862-2.107c0-.79.31-1.548.862-2.107l4.51-4.564a.98.98 0 0 1 .694-.291.97.97 0 0 1 .694.29 1 1 0 0 1 .288.703 1 1 0 0 1-.287.702l-4.511 4.564a1 1 0 0 0-.288.703 1 1 0 0 0 .288.702.98.98 0 0 0 .694.29.97.97 0 0 0 .694-.29l5.55-5.618a2.98 2.98 0 0 0 .9-2.117 3 3 0 0 0-.863-2.133 2.94 2.94 0 0 0-2.107-.872 2.91 2.91 0 0 0-2.092.909L7.4 11.538a5 5 0 0 0-1.393 3.498 5 5 0 0 0 1.437 3.479 4.88 4.88 0 0 0 3.438 1.454 4.88 4.88 0 0 0 3.456-1.41z"
                />
              </svg>
            </div>
            <div class="map" (click)="sendGeolocation()">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="14"
                height="18"
                fill="none"
                viewBox="0 0 14 18"
              >
                <path
                  fill="currentColor"
                  fill-rule="evenodd"
                  d="M1.676 11.545a7 7 0 1 1 10.568.092L7 18zM7 10.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
          </div>
          <textarea
            rows="1"
            placeholder="Напишите сообщение..."
            [(ngModel)]="messageInput"
            (keydown.enter)="sendMessage(); $event.preventDefault()"
            (input)="onInputChange()"
          ></textarea>
          <emoji-picker
            *ngIf="showEmojiPicker"
            (emoji-click)="addEmoji($event)"
            class="emoji-picker"
          ></emoji-picker>
          <div class="emoji__picker" (click)="toggleEmojiPicker()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              version="1.1"
              viewBox="0 0 32 32"
            >
              <path
                fill="currentColor"
                d="M4 16.656q0-2.469 0.938-4.656t2.578-3.813 3.828-2.563q2.156-0.969 4.656-0.969t4.656 0.969q2.188 0.938 3.828 2.563t2.578 3.813 0.938 4.656q0 2.5-0.938 4.688t-2.578 3.813-3.828 2.563q-2.156 0.938-4.656 0.938t-4.656-0.938q-2.188-0.938-3.828-2.563t-2.578-3.813-0.938-4.688M16 2q-3.031 0-5.719 1.156-2.656 1.156-4.656 3.141t-3.125 4.672q-1.156 2.656-1.156 5.688 0 3.063 1.156 5.719 1.125 2.688 3.125 4.672t4.656 3.141q2.688 1.156 5.719 1.156t5.719-1.156q2.656-1.156 4.656-3.141t3.125-4.672q1.156-2.656 1.156-5.719 0-3.031-1.156-5.688-1.125-2.688-3.125-4.672t-4.656-3.141q-2.688-1.156-5.719-1.156M10.594 19.406q-0.25-0.469-0.75-0.625t-0.969 0.094q-0.469 0.219-0.625 0.719t0.094 0.969q1.063 2.094 3.109 3.406t4.547 1.313 4.547-1.313 3.109-3.375q0.25-0.469 0.078-0.969t-0.641-0.75q-0.438-0.25-0.938-0.078t-0.75 0.641q-0.75 1.469-2.203 2.375t-3.203 0.906q-1.781 0-3.219-0.906t-2.188-2.406v0M13.344 13.344q0 0.813-0.5 1.406t-1.188 0.594-1.172-0.594-0.484-1.406q0-0.844 0.484-1.422t1.172-0.578 1.188 0.578 0.5 1.422v0M20.344 15.344q0.688 0 1.172-0.594t0.484-1.406q0-0.844-0.484-1.422t-1.172-0.578-1.188 0.578-0.5 1.422q0 0.813 0.5 1.406t1.188 0.594z"
              />
            </svg>
          </div>
          <button
            class="send"
            *ngIf="messageInput && messageInput.trim().length > 0"
            [ngClass]="{'visible': messageInput.trim()}"
            (click)="sendMessage()"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="none"
              viewBox="0 0 24 24"
            >
              <path
                fill="#fff"
                d="M4.467 21.914 22.241 13c1.012-.5 1.012-1.5 0-2L4.467 2.086a1.05 1.05 0 0 0-1.382.56c-.073.172-.1.362-.077.55l.898 6.082a1 1 0 0 0 .827.84L16.165 12 4.733 13.882a1 1 0 0 0-.827.84l-.898 6.083a1.06 1.06 0 0 0 .915 1.187c.185.023.373-.004.544-.078"
              />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>